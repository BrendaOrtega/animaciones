import{r as R,j as c,R as G,g as Vt}from"./jsx-runtime-DYkViK2L.js";import{a as kt,u as Ct,D as Rt}from"./index-BoL28IBb.js";import{a as Ot,b as Lt,P as we}from"./PrimaryButton-BuUOKRux.js";import{u as Pt,f as Ut,L as Qe,a as It,m as Pe}from"./proxy-CV3wXh37.js";import{c as ge}from"./utils-D7At0r7h.js";import{a as pe,F as Mt,u as Bt}from"./components-BMN4foKF.js";import"./index-MSxA10Hv.js";const zt=R.createContext(null);function qt(){const e=R.useRef(!1);return Pt(()=>(e.current=!0,()=>{e.current=!1}),[]),e}function Kt(){const e=qt(),[t,r]=R.useState(0),s=R.useCallback(()=>{e.current&&r(t+1)},[t]);return[R.useCallback(()=>Ut.postRender(s),[s]),t]}const Gt=e=>!e.isLayoutDirty&&e.willUpdate(!1);function et(){const e=new Set,t=new WeakMap,r=()=>e.forEach(Gt);return{add:s=>{e.add(s),t.set(s,s.addEventListener("willUpdate",r))},remove:s=>{e.delete(s);const a=t.get(s);a&&(a(),t.delete(s)),r()},dirty:r}}const ft=e=>e===!0,$t=e=>ft(e===!0)||e==="id",Wt=({children:e,id:t,inherit:r=!0})=>{const s=R.useContext(Qe),a=R.useContext(zt),[n,u]=Kt(),f=R.useRef(null),_=s.id||a;f.current===null&&($t(r)&&_&&(t=t?_+"-"+t:_),f.current={id:t,group:ft(r)&&s.group||et()});const T=R.useMemo(()=>({...f.current,forceRender:n}),[u]);return c.jsx(Qe.Provider,{value:T,children:e})};class Ht{constructor(){this.componentControls=new Set}subscribe(t){return this.componentControls.add(t),()=>this.componentControls.delete(t)}start(t,r){this.componentControls.forEach(s=>{s.start(t.nativeEvent||t,r)})}}const Jt=()=>new Ht;function yt(){return It(Jt)}const ht=({onPointerDown:e})=>c.jsx(Pe.button,{whileTap:{cursor:"grabbing",boxShadow:"0px 0px 24px 0px gray"},className:"cursor-grab py-px pr-px shadow-[unset] text-xl text-gray-900",onPointerDown:t=>{t.stopPropagation(),e==null||e(t)},children:c.jsx(kt,{})}),Yt=({video:e,onClick:t,onReorder:r})=>{const s=pe(),a=yt(),n=(u,f)=>{const T=document.elementsFromPoint(u.clientX,u.clientY).find(x=>x.dataset.videoindex&&x.dataset.videoindex!==String(e.index));T&&(r==null||r(Number(e.index),Number(T.dataset.videoindex)),s.submit({intent:"update_video",data:JSON.stringify([{}])},{method:"POST"}))};return c.jsxs(Pe.div,{"data-videoindex":e.index,onDragEnd:n,dragListener:!1,drag:!0,dragControls:a,dragSnapToOrigin:!0,onClick:t,className:ge("hover:scale-[1.02] text-left py-1 px-4 rounded","bg-slate-400","flex gap-2"),children:[c.jsx(ht,{onPointerDown:u=>{a.start(u)}}),c.jsx("p",{className:"truncate",children:e.title}),c.jsxs("div",{className:"ml-auto flex gap-2 items-center",children:[e.isPublic&&c.jsx("span",{children:"🌎"}),c.jsx("span",{children:e.storageKey?"📼":"🫥"}),[...new Set(e.m3u8||[])].map(u=>c.jsx("span",{className:"text-xs text-white bg-blue-500 py-px px-2 rounded-full",children:u},u))]})]})},Xt=({title:e,videos:t=[],onAddVideo:r,onVideoSelect:s,onModuleTitleUpdate:a,onModuleOrderUpdate:n,index:u})=>{const f=pe(),[_,T]=R.useState(!0),[x,g]=R.useState(!1),V=Ct({isActive:x,includeEscape:!0,onOutsideClick:()=>{g(!1)}}),A=()=>{r==null||r(e)},S=b=>{b.preventDefault();const j=new FormData(b.currentTarget).get("title");j&&(a==null||a(e,j),f.submit({intent:"update_modulename",oldModuleName:e,newModuleName:j},{method:"post"}))},F=yt(),E=b=>{const j=document.elementsFromPoint(b.clientX,b.clientY).find(q=>q.dataset.index&&q.dataset.index!==String(u));j&&(n==null||n(Number(u),Number(j.dataset.index)))};return c.jsxs(Pe.article,{layout:!0,layoutId:e,className:"relative",drag:!0,dragControls:F,dragSnapToOrigin:!0,onDragEnd:E,"data-index":u,dragListener:!1,children:[c.jsxs("section",{className:"bg-slate-600 py-2 px-4 flex justify-between items-center mt-2 ",children:[c.jsx(ht,{onPointerDown:b=>F.start(b)}),x?c.jsx("form",{ref:V,onSubmit:S,children:c.jsx("input",{defaultValue:e,autoFocus:!0,className:"rounded py-1 px-2",placeholder:"Escribe un nuevo titulo",name:"title"})}):c.jsxs(c.Fragment,{children:[c.jsxs("p",{className:"text-gray-400 w-10 text-center",children:[" ",u+1]}),c.jsx("button",{onClick:()=>g(!0),className:"text-white font-bold capitalize text-left",children:e||"Sin título"})]}),c.jsx("button",{className:"flex-grow flex justify-end",onClick:()=>T(b=>!b),children:_?c.jsx(Ot,{}):c.jsx(Lt,{})})]}),_&&c.jsxs("section",{className:"min-h-20 bg-slate-300 p-4 flex flex-col gap-2 group",children:[t.length<1&&c.jsx("p",{className:"text-center py-6",children:"No hay videos"}),t.sort((b,p)=>b.index<p.index?-1:1).map((b,p)=>c.jsx(Yt,{onClick:()=>s==null?void 0:s(b),video:b},b.id)),c.jsx(we,{onClick:A,className:"group-hover:visible invisible ml-auto",children:"Añadir video"})]})]},e)};var xe=e=>e.type==="checkbox",ae=e=>e instanceof Date,z=e=>e==null;const mt=e=>typeof e=="object";var L=e=>!z(e)&&!Array.isArray(e)&&mt(e)&&!ae(e),Zt=e=>L(e)&&e.target?xe(e.target)?e.target.checked:e.target.value:e,Qt=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,er=(e,t)=>e.has(Qt(t)),tr=e=>{const t=e.constructor&&e.constructor.prototype;return L(t)&&t.hasOwnProperty("isPrototypeOf")},Ue=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function H(e){let t;const r=Array.isArray(e);if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set(e);else if(!(Ue&&(e instanceof Blob||e instanceof FileList))&&(r||L(e)))if(t=r?[]:{},!r&&!tr(e))t=e;else for(const s in e)e.hasOwnProperty(s)&&(t[s]=H(e[s]));else return e;return t}var Ae=e=>Array.isArray(e)?e.filter(Boolean):[],O=e=>e===void 0,m=(e,t,r)=>{if(!t||!L(e))return r;const s=Ae(t.split(/[,[\].]+?/)).reduce((a,n)=>z(a)?a:a[n],e);return O(s)||s===e?O(e[t])?r:e[t]:s},Z=e=>typeof e=="boolean",Ie=e=>/^\w*$/.test(e),gt=e=>Ae(e.replace(/["|']|\]/g,"").split(/\.|\[/)),k=(e,t,r)=>{let s=-1;const a=Ie(t)?[t]:gt(t),n=a.length,u=n-1;for(;++s<n;){const f=a[s];let _=r;if(s!==u){const T=e[f];_=L(T)||Array.isArray(T)?T:isNaN(+a[s+1])?{}:[]}if(f==="__proto__")return;e[f]=_,e=e[f]}return e};const tt={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},X={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},te={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"};G.createContext(null);var rr=(e,t,r,s=!0)=>{const a={defaultValues:t._defaultValues};for(const n in e)Object.defineProperty(a,n,{get:()=>{const u=n;return t._proxyFormState[u]!==X.all&&(t._proxyFormState[u]=!s||X.all),e[u]}});return a},K=e=>L(e)&&!Object.keys(e).length,sr=(e,t,r,s)=>{r(e);const{name:a,...n}=e;return K(n)||Object.keys(n).length>=Object.keys(t).length||Object.keys(n).find(u=>t[u]===X.all)},be=e=>Array.isArray(e)?e:[e];function ir(e){const t=G.useRef(e);t.current=e,G.useEffect(()=>{const r=!e.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{r&&r.unsubscribe()}},[e.disabled])}var Q=e=>typeof e=="string",nr=(e,t,r,s,a)=>Q(e)?(s&&t.watch.add(e),m(r,e,a)):Array.isArray(e)?e.map(n=>(s&&t.watch.add(n),m(r,n))):(s&&(t.watchAll=!0),r),ar=(e,t,r,s,a)=>t?{...r[e],types:{...r[e]&&r[e].types?r[e].types:{},[s]:a||!0}}:{},rt=e=>({isOnSubmit:!e||e===X.onSubmit,isOnBlur:e===X.onBlur,isOnChange:e===X.onChange,isOnAll:e===X.all,isOnTouch:e===X.onTouched}),st=(e,t,r)=>!r&&(t.watchAll||t.watch.has(e)||[...t.watch].some(s=>e.startsWith(s)&&/^\.\w+/.test(e.slice(s.length))));const me=(e,t,r,s)=>{for(const a of r||Object.keys(e)){const n=m(e,a);if(n){const{_f:u,...f}=n;if(u){if(u.refs&&u.refs[0]&&t(u.refs[0],a)&&!s)return!0;if(u.ref&&t(u.ref,u.name)&&!s)return!0;if(me(f,t))break}else if(L(f)&&me(f,t))break}}};var or=(e,t,r)=>{const s=be(m(e,r));return k(s,"root",t[r]),k(e,r,s),e},Me=e=>e.type==="file",re=e=>typeof e=="function",Fe=e=>{if(!Ue)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},_e=e=>Q(e),Be=e=>e.type==="radio",Ne=e=>e instanceof RegExp;const it={value:!1,isValid:!1},nt={value:!0,isValid:!0};var pt=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(r=>r&&r.checked&&!r.disabled).map(r=>r.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!O(e[0].attributes.value)?O(e[0].value)||e[0].value===""?nt:{value:e[0].value,isValid:!0}:nt:it}return it};const at={isValid:!1,value:null};var xt=e=>Array.isArray(e)?e.reduce((t,r)=>r&&r.checked&&!r.disabled?{isValid:!0,value:r.value}:t,at):at;function ot(e,t,r="validate"){if(_e(e)||Array.isArray(e)&&e.every(_e)||Z(e)&&!e)return{type:r,message:_e(e)?e:"",ref:t}}var ue=e=>L(e)&&!Ne(e)?e:{value:e,message:""},lt=async(e,t,r,s,a)=>{const{ref:n,refs:u,required:f,maxLength:_,minLength:T,min:x,max:g,pattern:V,validate:A,name:S,valueAsNumber:F,mount:E,disabled:b}=e._f,p=m(t,S);if(!E||b)return{};const j=u?u[0]:n,q=N=>{s&&j.reportValidity&&(j.setCustomValidity(Z(N)?"":N||""),j.reportValidity())},C={},ee=Be(n),oe=xe(n),ie=ee||oe,le=(F||Me(n))&&O(n.value)&&O(p)||Fe(n)&&n.value===""||p===""||Array.isArray(p)&&!p.length,$=ar.bind(null,S,r,C),ve=(N,D,P,B=te.maxLength,Y=te.minLength)=>{const W=N?D:P;C[S]={type:N?B:Y,message:W,ref:n,...$(N?B:Y,W)}};if(a?!Array.isArray(p)||!p.length:f&&(!ie&&(le||z(p))||Z(p)&&!p||oe&&!pt(u).isValid||ee&&!xt(u).isValid)){const{value:N,message:D}=_e(f)?{value:!!f,message:f}:ue(f);if(N&&(C[S]={type:te.required,message:D,ref:j,...$(te.required,D)},!r))return q(D),C}if(!le&&(!z(x)||!z(g))){let N,D;const P=ue(g),B=ue(x);if(!z(p)&&!isNaN(p)){const Y=n.valueAsNumber||p&&+p;z(P.value)||(N=Y>P.value),z(B.value)||(D=Y<B.value)}else{const Y=n.valueAsDate||new Date(p),W=fe=>new Date(new Date().toDateString()+" "+fe),ce=n.type=="time",de=n.type=="week";Q(P.value)&&p&&(N=ce?W(p)>W(P.value):de?p>P.value:Y>new Date(P.value)),Q(B.value)&&p&&(D=ce?W(p)<W(B.value):de?p<B.value:Y<new Date(B.value))}if((N||D)&&(ve(!!N,P.message,B.message,te.max,te.min),!r))return q(C[S].message),C}if((_||T)&&!le&&(Q(p)||a&&Array.isArray(p))){const N=ue(_),D=ue(T),P=!z(N.value)&&p.length>+N.value,B=!z(D.value)&&p.length<+D.value;if((P||B)&&(ve(P,N.message,D.message),!r))return q(C[S].message),C}if(V&&!le&&Q(p)){const{value:N,message:D}=ue(V);if(Ne(N)&&!p.match(N)&&(C[S]={type:te.pattern,message:D,ref:n,...$(te.pattern,D)},!r))return q(D),C}if(A){if(re(A)){const N=await A(p,t),D=ot(N,j);if(D&&(C[S]={...D,...$(te.validate,D.message)},!r))return q(D.message),C}else if(L(A)){let N={};for(const D in A){if(!K(N)&&!r)break;const P=ot(await A[D](p,t),j,D);P&&(N={...P,...$(D,P.message)},q(P.message),r&&(C[S]=N))}if(!K(N)&&(C[S]={ref:j,...N},!r))return C}}return q(!0),C};function lr(e,t){const r=t.slice(0,-1).length;let s=0;for(;s<r;)e=O(e)?s++:e[t[s++]];return e}function ur(e){for(const t in e)if(e.hasOwnProperty(t)&&!O(e[t]))return!1;return!0}function U(e,t){const r=Array.isArray(t)?t:Ie(t)?[t]:gt(t),s=r.length===1?e:lr(e,r),a=r.length-1,n=r[a];return s&&delete s[n],a!==0&&(L(s)&&K(s)||Array.isArray(s)&&ur(s))&&U(e,r.slice(0,-1)),e}var Ve=()=>{let e=[];return{get observers(){return e},next:a=>{for(const n of e)n.next&&n.next(a)},subscribe:a=>(e.push(a),{unsubscribe:()=>{e=e.filter(n=>n!==a)}}),unsubscribe:()=>{e=[]}}},Oe=e=>z(e)||!mt(e);function se(e,t){if(Oe(e)||Oe(t))return e===t;if(ae(e)&&ae(t))return e.getTime()===t.getTime();const r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(const a of r){const n=e[a];if(!s.includes(a))return!1;if(a!=="ref"){const u=t[a];if(ae(n)&&ae(u)||L(n)&&L(u)||Array.isArray(n)&&Array.isArray(u)?!se(n,u):n!==u)return!1}}return!0}var vt=e=>e.type==="select-multiple",cr=e=>Be(e)||xe(e),ke=e=>Fe(e)&&e.isConnected,bt=e=>{for(const t in e)if(re(e[t]))return!0;return!1};function Te(e,t={}){const r=Array.isArray(e);if(L(e)||r)for(const s in e)Array.isArray(e[s])||L(e[s])&&!bt(e[s])?(t[s]=Array.isArray(e[s])?[]:{},Te(e[s],t[s])):z(e[s])||(t[s]=!0);return t}function _t(e,t,r){const s=Array.isArray(e);if(L(e)||s)for(const a in e)Array.isArray(e[a])||L(e[a])&&!bt(e[a])?O(t)||Oe(r[a])?r[a]=Array.isArray(e[a])?Te(e[a],[]):{...Te(e[a])}:_t(e[a],z(t)?{}:t[a],r[a]):r[a]=!se(e[a],t[a]);return r}var ye=(e,t)=>_t(e,t,Te(t)),wt=(e,{valueAsNumber:t,valueAsDate:r,setValueAs:s})=>O(e)?e:t?e===""?NaN:e&&+e:r&&Q(e)?new Date(e):s?s(e):e;function Ce(e){const t=e.ref;if(!(e.refs?e.refs.every(r=>r.disabled):t.disabled))return Me(t)?t.files:Be(t)?xt(e.refs).value:vt(t)?[...t.selectedOptions].map(({value:r})=>r):xe(t)?pt(e.refs).value:wt(O(t.value)?e.ref.value:t.value,e)}var dr=(e,t,r,s)=>{const a={};for(const n of e){const u=m(t,n);u&&k(a,n,u._f)}return{criteriaMode:r,names:[...e],fields:a,shouldUseNativeValidation:s}},he=e=>O(e)?e:Ne(e)?e.source:L(e)?Ne(e.value)?e.value.source:e.value:e;const ut="AsyncFunction";var fr=e=>(!e||!e.validate)&&!!(re(e.validate)&&e.validate.constructor.name===ut||L(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===ut)),yr=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate);function ct(e,t,r){const s=m(e,r);if(s||Ie(r))return{error:s,name:r};const a=r.split(".");for(;a.length;){const n=a.join("."),u=m(t,n),f=m(e,n);if(u&&!Array.isArray(u)&&r!==n)return{name:r};if(f&&f.type)return{name:n,error:f};a.pop()}return{name:r}}var hr=(e,t,r,s,a)=>a.isOnAll?!1:!r&&a.isOnTouch?!(t||e):(r?s.isOnBlur:a.isOnBlur)?!e:(r?s.isOnChange:a.isOnChange)?e:!0,mr=(e,t)=>!Ae(m(e,t)).length&&U(e,t);const gr={mode:X.onSubmit,reValidateMode:X.onChange,shouldFocusError:!0};function pr(e={}){let t={...gr,...e},r={submitCount:0,isDirty:!1,isLoading:re(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},s={},a=L(t.defaultValues)||L(t.values)?H(t.defaultValues||t.values)||{}:{},n=t.shouldUnregister?{}:H(a),u={action:!1,mount:!1,watch:!1},f={mount:new Set,unMount:new Set,array:new Set,watch:new Set},_,T=0;const x={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},g={values:Ve(),array:Ve(),state:Ve()},V=rt(t.mode),A=rt(t.reValidateMode),S=t.criteriaMode===X.all,F=i=>o=>{clearTimeout(T),T=setTimeout(i,o)},E=async i=>{if(!e.disabled&&(x.isValid||i)){const o=t.resolver?K((await ie()).errors):await $(s,!0);o!==r.isValid&&g.state.next({isValid:o})}},b=(i,o)=>{!e.disabled&&(x.isValidating||x.validatingFields)&&((i||Array.from(f.mount)).forEach(l=>{l&&(o?k(r.validatingFields,l,o):U(r.validatingFields,l))}),g.state.next({validatingFields:r.validatingFields,isValidating:!K(r.validatingFields)}))},p=(i,o=[],l,h,y=!0,d=!0)=>{if(h&&l&&!e.disabled){if(u.action=!0,d&&Array.isArray(m(s,i))){const v=l(m(s,i),h.argA,h.argB);y&&k(s,i,v)}if(d&&Array.isArray(m(r.errors,i))){const v=l(m(r.errors,i),h.argA,h.argB);y&&k(r.errors,i,v),mr(r.errors,i)}if(x.touchedFields&&d&&Array.isArray(m(r.touchedFields,i))){const v=l(m(r.touchedFields,i),h.argA,h.argB);y&&k(r.touchedFields,i,v)}x.dirtyFields&&(r.dirtyFields=ye(a,n)),g.state.next({name:i,isDirty:N(i,o),dirtyFields:r.dirtyFields,errors:r.errors,isValid:r.isValid})}else k(n,i,o)},j=(i,o)=>{k(r.errors,i,o),g.state.next({errors:r.errors})},q=i=>{r.errors=i,g.state.next({errors:r.errors,isValid:!1})},C=(i,o,l,h)=>{const y=m(s,i);if(y){const d=m(n,i,O(l)?m(a,i):l);O(d)||h&&h.defaultChecked||o?k(n,i,o?d:Ce(y._f)):B(i,d),u.mount&&E()}},ee=(i,o,l,h,y)=>{let d=!1,v=!1;const w={name:i};if(!e.disabled){const I=!!(m(s,i)&&m(s,i)._f&&m(s,i)._f.disabled);if(!l||h){x.isDirty&&(v=r.isDirty,r.isDirty=w.isDirty=N(),d=v!==w.isDirty);const M=I||se(m(a,i),o);v=!!(!I&&m(r.dirtyFields,i)),M||I?U(r.dirtyFields,i):k(r.dirtyFields,i,!0),w.dirtyFields=r.dirtyFields,d=d||x.dirtyFields&&v!==!M}if(l){const M=m(r.touchedFields,i);M||(k(r.touchedFields,i,l),w.touchedFields=r.touchedFields,d=d||x.touchedFields&&M!==l)}d&&y&&g.state.next(w)}return d?w:{}},oe=(i,o,l,h)=>{const y=m(r.errors,i),d=x.isValid&&Z(o)&&r.isValid!==o;if(e.delayError&&l?(_=F(()=>j(i,l)),_(e.delayError)):(clearTimeout(T),_=null,l?k(r.errors,i,l):U(r.errors,i)),(l?!se(y,l):y)||!K(h)||d){const v={...h,...d&&Z(o)?{isValid:o}:{},errors:r.errors,name:i};r={...r,...v},g.state.next(v)}},ie=async i=>{b(i,!0);const o=await t.resolver(n,t.context,dr(i||f.mount,s,t.criteriaMode,t.shouldUseNativeValidation));return b(i),o},le=async i=>{const{errors:o}=await ie(i);if(i)for(const l of i){const h=m(o,l);h?k(r.errors,l,h):U(r.errors,l)}else r.errors=o;return o},$=async(i,o,l={valid:!0})=>{for(const h in i){const y=i[h];if(y){const{_f:d,...v}=y;if(d){const w=f.array.has(d.name),I=y._f&&fr(y._f);I&&x.validatingFields&&b([h],!0);const M=await lt(y,n,S,t.shouldUseNativeValidation&&!o,w);if(I&&x.validatingFields&&b([h]),M[d.name]&&(l.valid=!1,o))break;!o&&(m(M,d.name)?w?or(r.errors,M,d.name):k(r.errors,d.name,M[d.name]):U(r.errors,d.name))}!K(v)&&await $(v,o,l)}}return l.valid},ve=()=>{for(const i of f.unMount){const o=m(s,i);o&&(o._f.refs?o._f.refs.every(l=>!ke(l)):!ke(o._f.ref))&&Se(i)}f.unMount=new Set},N=(i,o)=>!e.disabled&&(i&&o&&k(n,i,o),!se(qe(),a)),D=(i,o,l)=>nr(i,f,{...u.mount?n:O(o)?a:Q(i)?{[i]:o}:o},l,o),P=i=>Ae(m(u.mount?n:a,i,e.shouldUnregister?m(a,i,[]):[])),B=(i,o,l={})=>{const h=m(s,i);let y=o;if(h){const d=h._f;d&&(!d.disabled&&k(n,i,wt(o,d)),y=Fe(d.ref)&&z(o)?"":o,vt(d.ref)?[...d.ref.options].forEach(v=>v.selected=y.includes(v.value)):d.refs?xe(d.ref)?d.refs.length>1?d.refs.forEach(v=>(!v.defaultChecked||!v.disabled)&&(v.checked=Array.isArray(y)?!!y.find(w=>w===v.value):y===v.value)):d.refs[0]&&(d.refs[0].checked=!!y):d.refs.forEach(v=>v.checked=v.value===y):Me(d.ref)?d.ref.value="":(d.ref.value=y,d.ref.type||g.values.next({name:i,values:{...n}})))}(l.shouldDirty||l.shouldTouch)&&ee(i,y,l.shouldTouch,l.shouldDirty,!0),l.shouldValidate&&fe(i)},Y=(i,o,l)=>{for(const h in o){const y=o[h],d=`${i}.${h}`,v=m(s,d);(f.array.has(i)||L(y)||v&&!v._f)&&!ae(y)?Y(d,y,l):B(d,y,l)}},W=(i,o,l={})=>{const h=m(s,i),y=f.array.has(i),d=H(o);k(n,i,d),y?(g.array.next({name:i,values:{...n}}),(x.isDirty||x.dirtyFields)&&l.shouldDirty&&g.state.next({name:i,dirtyFields:ye(a,n),isDirty:N(i,d)})):h&&!h._f&&!z(d)?Y(i,d,l):B(i,d,l),st(i,f)&&g.state.next({...r}),g.values.next({name:u.mount?i:void 0,values:{...n}})},ce=async i=>{u.mount=!0;const o=i.target;let l=o.name,h=!0;const y=m(s,l),d=()=>o.type?Ce(y._f):Zt(i),v=w=>{h=Number.isNaN(w)||ae(w)&&isNaN(w.getTime())||se(w,m(n,l,w))};if(y){let w,I;const M=d(),ne=i.type===tt.BLUR||i.type===tt.FOCUS_OUT,Et=!yr(y._f)&&!t.resolver&&!m(r.errors,l)&&!y._f.deps||hr(ne,m(r.touchedFields,l),r.isSubmitted,A,V),De=st(l,f,ne);k(n,l,M),ne?(y._f.onBlur&&y._f.onBlur(i),_&&_(0)):y._f.onChange&&y._f.onChange(i);const je=ee(l,M,ne,!1),Dt=!K(je)||De;if(!ne&&g.values.next({name:l,type:i.type,values:{...n}}),Et)return x.isValid&&(e.mode==="onBlur"?ne&&E():E()),Dt&&g.state.next({name:l,...De?{}:je});if(!ne&&De&&g.state.next({...r}),t.resolver){const{errors:Xe}=await ie([l]);if(v(M),h){const jt=ct(r.errors,s,l),Ze=ct(Xe,s,jt.name||l);w=Ze.error,l=Ze.name,I=K(Xe)}}else b([l],!0),w=(await lt(y,n,S,t.shouldUseNativeValidation))[l],b([l]),v(M),h&&(w?I=!1:x.isValid&&(I=await $(s,!0)));h&&(y._f.deps&&fe(y._f.deps),oe(l,I,w,je))}},de=(i,o)=>{if(m(r.errors,o)&&i.focus)return i.focus(),1},fe=async(i,o={})=>{let l,h;const y=be(i);if(t.resolver){const d=await le(O(i)?i:y);l=K(d),h=i?!y.some(v=>m(d,v)):l}else i?(h=(await Promise.all(y.map(async d=>{const v=m(s,d);return await $(v&&v._f?{[d]:v}:v)}))).every(Boolean),!(!h&&!r.isValid)&&E()):h=l=await $(s);return g.state.next({...!Q(i)||x.isValid&&l!==r.isValid?{}:{name:i},...t.resolver||!i?{isValid:l}:{},errors:r.errors}),o.shouldFocus&&!h&&me(s,de,i?y:f.mount),h},qe=i=>{const o={...u.mount?n:a};return O(i)?o:Q(i)?m(o,i):i.map(l=>m(o,l))},Ke=(i,o)=>({invalid:!!m((o||r).errors,i),isDirty:!!m((o||r).dirtyFields,i),error:m((o||r).errors,i),isValidating:!!m(r.validatingFields,i),isTouched:!!m((o||r).touchedFields,i)}),Nt=i=>{i&&be(i).forEach(o=>U(r.errors,o)),g.state.next({errors:i?r.errors:{}})},Ge=(i,o,l)=>{const h=(m(s,i,{_f:{}})._f||{}).ref,y=m(r.errors,i)||{},{ref:d,message:v,type:w,...I}=y;k(r.errors,i,{...I,...o,ref:h}),g.state.next({name:i,errors:r.errors,isValid:!1}),l&&l.shouldFocus&&h&&h.focus&&h.focus()},Tt=(i,o)=>re(i)?g.values.subscribe({next:l=>i(D(void 0,o),l)}):D(i,o,!0),Se=(i,o={})=>{for(const l of i?be(i):f.mount)f.mount.delete(l),f.array.delete(l),o.keepValue||(U(s,l),U(n,l)),!o.keepError&&U(r.errors,l),!o.keepDirty&&U(r.dirtyFields,l),!o.keepTouched&&U(r.touchedFields,l),!o.keepIsValidating&&U(r.validatingFields,l),!t.shouldUnregister&&!o.keepDefaultValue&&U(a,l);g.values.next({values:{...n}}),g.state.next({...r,...o.keepDirty?{isDirty:N()}:{}}),!o.keepIsValid&&E()},$e=({disabled:i,name:o,field:l,fields:h,value:y})=>{if(Z(i)&&u.mount||i){const d=i?void 0:O(y)?Ce(l?l._f:m(h,o)._f):y;k(n,o,d),ee(o,d,!1,!1,!0)}},Ee=(i,o={})=>{let l=m(s,i);const h=Z(o.disabled)||Z(e.disabled);return k(s,i,{...l||{},_f:{...l&&l._f?l._f:{ref:{name:i}},name:i,mount:!0,...o}}),f.mount.add(i),l?$e({field:l,disabled:Z(o.disabled)?o.disabled:e.disabled,name:i,value:o.value}):C(i,!0,o.value),{...h?{disabled:o.disabled||e.disabled}:{},...t.progressive?{required:!!o.required,min:he(o.min),max:he(o.max),minLength:he(o.minLength),maxLength:he(o.maxLength),pattern:he(o.pattern)}:{},name:i,onChange:ce,onBlur:ce,ref:y=>{if(y){Ee(i,o),l=m(s,i);const d=O(y.value)&&y.querySelectorAll&&y.querySelectorAll("input,select,textarea")[0]||y,v=cr(d),w=l._f.refs||[];if(v?w.find(I=>I===d):d===l._f.ref)return;k(s,i,{_f:{...l._f,...v?{refs:[...w.filter(ke),d,...Array.isArray(m(a,i))?[{}]:[]],ref:{type:d.type,name:i}}:{ref:d}}}),C(i,!1,void 0,d)}else l=m(s,i,{}),l._f&&(l._f.mount=!1),(t.shouldUnregister||o.shouldUnregister)&&!(er(f.array,i)&&u.action)&&f.unMount.add(i)}}},We=()=>t.shouldFocusError&&me(s,de,f.mount),At=i=>{Z(i)&&(g.state.next({disabled:i}),me(s,(o,l)=>{const h=m(s,l);h&&(o.disabled=h._f.disabled||i,Array.isArray(h._f.refs)&&h._f.refs.forEach(y=>{y.disabled=h._f.disabled||i}))},0,!1))},He=(i,o)=>async l=>{let h;l&&(l.preventDefault&&l.preventDefault(),l.persist&&l.persist());let y=H(n);if(g.state.next({isSubmitting:!0}),t.resolver){const{errors:d,values:v}=await ie();r.errors=d,y=v}else await $(s);if(U(r.errors,"root"),K(r.errors)){g.state.next({errors:{}});try{await i(y,l)}catch(d){h=d}}else o&&await o({...r.errors},l),We(),setTimeout(We);if(g.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:K(r.errors)&&!h,submitCount:r.submitCount+1,errors:r.errors}),h)throw h},St=(i,o={})=>{m(s,i)&&(O(o.defaultValue)?W(i,H(m(a,i))):(W(i,o.defaultValue),k(a,i,H(o.defaultValue))),o.keepTouched||U(r.touchedFields,i),o.keepDirty||(U(r.dirtyFields,i),r.isDirty=o.defaultValue?N(i,H(m(a,i))):N()),o.keepError||(U(r.errors,i),x.isValid&&E()),g.state.next({...r}))},Je=(i,o={})=>{const l=i?H(i):a,h=H(l),y=K(i),d=y?a:h;if(o.keepDefaultValues||(a=l),!o.keepValues){if(o.keepDirtyValues){const v=new Set([...f.mount,...Object.keys(ye(a,n))]);for(const w of Array.from(v))m(r.dirtyFields,w)?k(d,w,m(n,w)):W(w,m(d,w))}else{if(Ue&&O(i))for(const v of f.mount){const w=m(s,v);if(w&&w._f){const I=Array.isArray(w._f.refs)?w._f.refs[0]:w._f.ref;if(Fe(I)){const M=I.closest("form");if(M){M.reset();break}}}}s={}}n=e.shouldUnregister?o.keepDefaultValues?H(a):{}:H(d),g.array.next({values:{...d}}),g.values.next({values:{...d}})}f={mount:o.keepDirtyValues?f.mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},u.mount=!x.isValid||!!o.keepIsValid||!!o.keepDirtyValues,u.watch=!!e.shouldUnregister,g.state.next({submitCount:o.keepSubmitCount?r.submitCount:0,isDirty:y?!1:o.keepDirty?r.isDirty:!!(o.keepDefaultValues&&!se(i,a)),isSubmitted:o.keepIsSubmitted?r.isSubmitted:!1,dirtyFields:y?{}:o.keepDirtyValues?o.keepDefaultValues&&n?ye(a,n):r.dirtyFields:o.keepDefaultValues&&i?ye(a,i):o.keepDirty?r.dirtyFields:{},touchedFields:o.keepTouched?r.touchedFields:{},errors:o.keepErrors?r.errors:{},isSubmitSuccessful:o.keepIsSubmitSuccessful?r.isSubmitSuccessful:!1,isSubmitting:!1})},Ye=(i,o)=>Je(re(i)?i(n):i,o);return{control:{register:Ee,unregister:Se,getFieldState:Ke,handleSubmit:He,setError:Ge,_executeSchema:ie,_getWatch:D,_getDirty:N,_updateValid:E,_removeUnmounted:ve,_updateFieldArray:p,_updateDisabledField:$e,_getFieldArray:P,_reset:Je,_resetDefaultValues:()=>re(t.defaultValues)&&t.defaultValues().then(i=>{Ye(i,t.resetOptions),g.state.next({isLoading:!1})}),_updateFormState:i=>{r={...r,...i}},_disableForm:At,_subjects:g,_proxyFormState:x,_setErrors:q,get _fields(){return s},get _formValues(){return n},get _state(){return u},set _state(i){u=i},get _defaultValues(){return a},get _names(){return f},set _names(i){f=i},get _formState(){return r},set _formState(i){r=i},get _options(){return t},set _options(i){t={...t,...i}}},trigger:fe,register:Ee,handleSubmit:He,watch:Tt,setValue:W,getValues:qe,reset:Ye,resetField:St,clearErrors:Nt,unregister:Se,setError:Ge,setFocus:(i,o={})=>{const l=m(s,i),h=l&&l._f;if(h){const y=h.refs?h.refs[0]:h.ref;y.focus&&(y.focus(),o.shouldSelect&&y.select())}},getFieldState:Ke}}function xr(e={}){const t=G.useRef(),r=G.useRef(),[s,a]=G.useState({isDirty:!1,isValidating:!1,isLoading:re(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,defaultValues:re(e.defaultValues)?void 0:e.defaultValues});t.current||(t.current={...pr(e),formState:s});const n=t.current.control;return n._options=e,ir({subject:n._subjects.state,next:u=>{sr(u,n._proxyFormState,n._updateFormState)&&a({...n._formState})}}),G.useEffect(()=>n._disableForm(e.disabled),[n,e.disabled]),G.useEffect(()=>{if(n._proxyFormState.isDirty){const u=n._getDirty();u!==s.isDirty&&n._subjects.state.next({isDirty:u})}},[n,s.isDirty]),G.useEffect(()=>{e.values&&!se(e.values,r.current)?(n._reset(e.values,n._options.resetOptions),r.current=e.values,a(u=>({...u}))):n._resetDefaultValues()},[e.values,n]),G.useEffect(()=>{e.errors&&n._setErrors(e.errors)},[e.errors,n]),G.useEffect(()=>{n._state.mount||(n._updateValid(),n._state.mount=!0),n._state.watch&&(n._state.watch=!1,n._subjects.state.next({...n._formState})),n._removeUnmounted()}),G.useEffect(()=>{e.shouldUnregister&&n._subjects.values.next({values:n._getWatch()})},[e.shouldUnregister,n]),G.useEffect(()=>{t.current&&(t.current.watch=t.current.watch.bind({}))},[s]),t.current.formState=rr(s,n),t.current}const vr=({label:e,storageKey:t,setValue:r,name:s,defaultValue:a,register:n,className:u,...f})=>{const _=R.useRef(null),[T,x]=R.useState(""),[g,V]=R.useState({}),A=pe(),S=async p=>{var C,ee;const j=(ee=(C=p.currentTarget)==null?void 0:C.files)==null?void 0:ee[0];if(!j)return console.error("No file selected");const q=URL.createObjectURL(j);x(q),await fetch(g.putURL,{method:"PUT",body:j,headers:{"content-type":j.type,"content-size":j.size}}).catch(oe=>console.error(oe)),r==null||r(s,"/files?storageKey="+t)},F=()=>{A.submit({intent:"get_combo_urls",storageKey:t},{method:"POST"})};R.useEffect(()=>{A.data?V(A.data):F()},[A.data]);const E=T||a,b=p=>{x(p.currentTarget.value)};return c.jsx(c.Fragment,{children:c.jsxs("section",{className:ge("max-w-[30vw]",u),children:[c.jsx("p",{className:"",children:e}),c.jsx("input",{type:"text",name:s,defaultValue:a,className:"my-2 w-full rounded-lg disabled:bg-gray-200 text-gray-500",...n(s),onChange:b}),c.jsxs("button",{type:"button",onClick:()=>{var p;(p=_.current)==null||p.click()},className:ge("border-indigo-500 border-2 rounded-3xl border-dotted flex items-center justify-center text-indigo-500 cursor-pointer text-lg hover:text-xl transition-all w-full aspect-video",{"border-none":E}),children:[!E&&c.jsx("h2",{children:"Selecciona un archivo 📂 "}),E&&c.jsx("img",{className:"object-cover w-full aspect-video rounded-3xl",src:E,alt:"preview"})]}),c.jsx("input",{onChange:S,ref:_,hidden:!0,type:"file",accept:"image/*"})]})})},br=()=>c.jsx("div",{className:"border-4 rounded-full border-gray-200 animate-spin w-6 h-6 border-t-indigo-800"});var Ft={};function J(e,t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var _r=J;J.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};J.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};J.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(r===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);else return!1;var s=this;return this._timer=setTimeout(function(){s._attempts++,s._operationTimeoutCb&&(s._timeout=setTimeout(function(){s._operationTimeoutCb(s._attempts)},s._operationTimeout),s._options.unref&&s._timeout.unref()),s._fn(s._attempts)},r),this._options.unref&&this._timer.unref(),!0};J.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};J.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)};J.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)};J.prototype.start=J.prototype.try;J.prototype.errors=function(){return this._errors};J.prototype.attempts=function(){return this._attempts};J.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},t=null,r=0,s=0;s<this._errors.length;s++){var a=this._errors[s],n=a.message,u=(e[n]||0)+1;e[n]=u,u>=r&&(t=a,r=u)}return t};(function(e){var t=_r;e.operation=function(r){var s=e.timeouts(r);return new t(s,{forever:r&&(r.forever||r.retries===1/0),unref:r&&r.unref,maxRetryTime:r&&r.maxRetryTime})},e.timeouts=function(r){if(r instanceof Array)return[].concat(r);var s={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var a in r)s[a]=r[a];if(s.minTimeout>s.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],u=0;u<s.retries;u++)n.push(this.createTimeout(u,s));return r&&r.forever&&!n.length&&n.push(this.createTimeout(u,s)),n.sort(function(f,_){return f-_}),n},e.createTimeout=function(r,s){var a=s.randomize?Math.random()+1:1,n=Math.round(a*Math.max(s.minTimeout,1)*Math.pow(s.factor,r));return n=Math.min(n,s.maxTimeout),n},e.wrap=function(r,s,a){if(s instanceof Array&&(a=s,s=null),!a){a=[];for(var n in r)typeof r[n]=="function"&&a.push(n)}for(var u=0;u<a.length;u++){var f=a[u],_=r[f];r[f]=(function(x){var g=e.operation(s),V=Array.prototype.slice.call(arguments,1),A=V.pop();V.push(function(S){g.retry(S)||(S&&(arguments[0]=g.mainError()),A.apply(this,arguments))}),g.attempt(function(){x.apply(r,V)})}).bind(r,_),r[f].options=s}}})(Ft);var wr=Ft,Fr=wr;function Nr(e,t){function r(s,a){var n=t||{},u;"randomize"in n||(n.randomize=!0),u=Fr.operation(n);function f(x){a(x||new Error("Aborted"))}function _(x,g){if(x.bail){f(x);return}u.retry(x)?n.onRetry&&n.onRetry(x,g):a(u.mainError())}function T(x){var g;try{g=e(f,x)}catch(V){_(V,x);return}Promise.resolve(g).then(s).catch(function(A){_(A,x)})}u.attempt(T)}return new Promise(r)}var Tr=Nr;const ze=Vt(Tr);var Ar="create_multipart_upload",Sr="create_put_part_url",Er="complete_multipart_upload",Dr=1024*1024,Le=8*Dr,jr=async(e="/api/upload",t)=>{const r={method:"POST",body:JSON.stringify({intent:Ar,directory:t}),headers:{"content-type":"application/json"}};let s;try{s=await fetch(e,r).then(a=>a.json())}catch(a){throw a instanceof Error?a:new Error("Error on post to handler")}return s},Vr=async({partNumber:e,uploadId:t,handler:r="/api/upload",key:s})=>ze(async()=>await(await fetch(r,{method:"POST",body:JSON.stringify({partNumber:e,uploadId:t,key:s,intent:Sr})})).text(),{retries:5}),kr=async({attempts:e=1,url:t,blob:r})=>{let s=0;return await ze(async a=>{const n=await fetch(t,{method:"PUT",body:r});if(n.status===403){a(new Error("Unauthorized"));return}else{if(n.ok)return n;throw new Error("Unknown error")}},{retries:e,onRetry:a=>{s=s+1,a instanceof Error&&console.log(`retrying #${s} Put request of ${t}`)}})},Cr=async e=>{const{file:t,numberOfParts:r,uploadId:s,key:a,onUploadProgress:n,handler:u}=e;let f=0;const _=Array.from({length:r}).map(async(T,x)=>{const g=await Vr({partNumber:x+1,uploadId:s,key:a,handler:u}),V=x*Le,A=Math.min(V+Le,t.size),S=t.slice(V,A),F=await kr({url:g,blob:S});f+=S.size;const E=f/t.size*100;n==null||n({total:t.size,loaded:f,percentage:E});const b=F.headers.get("ETag");return String(b).replaceAll('"',"")});return await Promise.all(_)},Rr=async e=>{const{key:t,etags:r,uploadId:s,metadata:a,handler:n="/api/upload"}=e;return await ze(async()=>await(await fetch(n,{method:"POST",body:JSON.stringify({intent:Er,contentType:a.type,size:a.size,metadata:a,uploadId:s,etags:r,key:t})})).json())},Or=e=>{const{access:t="public",handler:r,onUploadProgress:s,multipart:a}=e||{};return{upload:async(u,f)=>{const _={name:f.name,size:f.size,type:f.type},T=Math.ceil(f.size/Le),{uploadId:x,key:g}=await jr(r,u),V=await Cr({file:f,handler:r,key:g,numberOfParts:T,uploadId:x,onUploadProgress:s}),A=await Rr({metadata:_,key:g,uploadId:x,etags:V,handler:r});return{uploadId:x,key:g,metadata:_,url:"",access:t,completedData:A}}}};const Lr=({video:e,setValue:t,label:r,name:s,register:a,className:n,onVideoLoads:u})=>{const f=R.useRef(null),[_,T]=R.useState(e.storageLink||""),[x,g]=R.useState(!1),[V,A]=R.useState(0),S=async b=>{var j;if(!((j=b.currentTarget.files)!=null&&j.length))return;const p=b.currentTarget.files[0];if("type"in p&&(p.type==="video/mp4"||p.type==="video/quicktime"))T(URL.createObjectURL(p)),E(p);else return console.error("No file selected")},{upload:F}=Or({handler:"/api/upload/"+e.id,onUploadProgress:({percentage:b})=>A(b)}),E=async b=>{g(!0);const{key:p}=await F("animaciones/video-",b),j=p.replace("animaciones/","");t("storageKey",j),t("storageLink","/files?storageKey="+j),g(!1)};return c.jsxs("section",{className:ge("my-2 grid gap-2 max-w-[50vw] md:max-w-[30vw]",n),children:[c.jsx("p",{children:r}),c.jsx("input",{type:"text",name:s,className:"disabled:pointer-events-none rounded-lg disabled:text-gray-500 disabled:bg-gray-200",disabled:!0,...a(s)}),c.jsx("input",{type:"file",onChange:S,accept:"video/mp4,video/x-m4v,video/*",className:"mb-2"})," ",x&&c.jsxs("div",{className:"flex gap-2",children:[c.jsx(br,{})," ",c.jsxs("span",{children:["Subiendo video ",V.toFixed(0),"% no cierre la ventana"]})]}),_&&c.jsx("video",{onCanPlay:b=>u==null?void 0:u(f,b),ref:f,src:_,className:"border rounded-xl my-2 aspect-video w-full",controls:!0})]})},Pr=({onSubmit:e,video:t,videosLength:r})=>{var S;const s=pe(),a=s.state!=="idle",{handleSubmit:n,register:u,formState:{isValid:f},setValue:_}=xr({defaultValues:{storageLink:`/videos?storageKey=${t.storageKey||`video-${t.id}`}`,storageKey:t.storageKey,title:t.title||"",isPublic:t.isPublic||!1,duration:t.duration,moduleName:t.moduleName,id:t.id,slug:t.slug,index:Number(t.index)||r,poster:t.poster}}),T=F=>{_("duration",String(Number(F.current.duration)/60))},x=F=>{s.submit({intent:"update_video",data:JSON.stringify(F)},{method:"POST"}),e==null||e(F)},g=()=>{!confirm("¿Seguro que quieres elminar?")||!t.id||(s.submit({intent:"delete_video",videoId:t.id},{method:"POST"}),e==null||e())},V=()=>{if(confirm("Esta operación gasta recursos, ¿estás segura de continuar?"))return!t.id||!t.storageKey?alert("ABORTANDO::No existe video"):s.submit({intent:"experiment",storageKey:t.storageKey},{method:"POST"})},A=s.data||{playListURL:null};return c.jsx(c.Fragment,{children:c.jsxs(Mt,{className:"flex flex-col h-full",onSubmit:n(x),children:[c.jsxs("h3",{className:"mb-2 text-gray-100 text-xl",children:["Nombre del modulo: ",t.moduleName]}),c.jsxs("h3",{className:"mb-2 text-gray-400 text-xl",children:[" ",t.slug]}),c.jsx(Re,{type:"number",placeholder:"posición en la lista",label:"Índice",register:u("index",{required:!0})}),c.jsx(Re,{placeholder:"Título del nuevo video",label:"Título del video",register:u("title",{required:!0})}),t.id&&c.jsx(Lr,{className:"text-white",label:"Link del video",name:"storageLink",video:t,setValue:_,register:u,onVideoLoads:T}),A.playListURL&&c.jsx("video",{controls:!0,className:"aspect-video",children:c.jsx("source",{src:A.playListURL,type:"application/x-mpegURL"})}),t.storageKeys&&t.storageKeys.length>0&&c.jsxs("div",{className:"text-white dark:text-black mb-2",children:[c.jsx("p",{children:"Otras versiones:"}),c.jsx("div",{className:"flex gap-2",children:(S=t.m3u8)==null?void 0:S.map(F=>c.jsx("p",{children:F},F))})]}),t.storageKey&&c.jsx("button",{onClick:V,type:"button",className:"dark:text-black text-white border rounded-md py-2 active:bg-gray-800 mb-4",children:"Generar Todas las Versiones"}),t.id&&c.jsxs(c.Fragment,{children:[c.jsxs("label",{className:"flex justify-between cursor-pointer my-4 text-white",children:[c.jsx("span",{children:"¿Este video es público?"}),c.jsx("input",{...u("isPublic"),name:"isPublic",className:"size-4 text-green-500",type:"checkbox"})]}),c.jsx(Re,{placeholder:"60",type:"text",label:"Duración del video en minutos",register:u("duration",{required:!1})})]}),t.id&&c.jsx(vr,{className:"text-white",setValue:_,defaultValue:t.poster,name:"poster",storageKey:"poster-"+t.id,label:"Link del poster",register:u}),c.jsxs("div",{className:"flex gap-2 pt-4 sticky bottom-0 bg-black",children:[c.jsx(we,{isDisabled:!f||a,className:"w-full",type:"submit",children:"Guardar"}),t.id&&c.jsx(we,{onClick:g,className:"w-full bg-red-500",type:"button",children:"Eliminar"})]})]})})},Re=({error:e,name:t,label:r,placeholder:s,register:a,isDisabled:n,type:u="text",...f})=>c.jsxs("label",{className:"flex flex-col gap-2 mb-4 text-white",children:[c.jsx("p",{className:"",children:r}),c.jsx("input",{disabled:n,placeholder:s,className:ge("shadow rounded-md py-2 px-4 border w-full","text-black",{"bg-gray-200 text-gray-500 pointer-events-none":n}),type:u,name:t,...f,...a}),e&&c.jsx("p",{children:e})]}),Ur=({setShowVideoDrawer:e,setVideo:t,showVideoDrawer:r,video:s,initialVideo:a,videos:n})=>c.jsx(Rt,{onClose:()=>{e(!1),t({})},isOpen:r,title:s.id?"Editar video":"Añadir video",cta:c.jsx(c.Fragment,{}),children:c.jsx(Pr,{onSubmit:()=>{t(s),e(!1)},video:s||a,videosLength:n.length})}),dt={title:"Nuevo video",moduleName:""};function Yr(){const e=pe(),{course:t,moduleNamesOrder:r,videos:s}=Bt(),[a,n]=R.useState(dt),[u,f]=R.useState(!1),[_,T]=R.useState(r),x=F=>{F.preventDefault();const E=new FormData(F.currentTarget),b=String(E.get("name"));b&&T(p=>[...p,b])},g=F=>{f(!0),n(E=>({...E,moduleName:F}))},V=F=>{n(F),f(!0)},A=(F,E)=>{T(b=>b.map(p=>p===F?E:p))},S=(F,E)=>{const b=[..._],p=b.splice(F,1)[0];b.splice(E,0,p),T(b),e.submit({intent:"update_modules_order",moduleNamesOrder:JSON.stringify(b),courseId:t.id},{method:"post"})};return c.jsxs(c.Fragment,{children:[c.jsx(Ur,{setShowVideoDrawer:f,setVideo:n,showVideoDrawer:u,video:a,initialVideo:dt,videos:s}),c.jsxs("article",{className:"bg-gradient-to-tr from-slate-950 to-indigo-950 min-h-screen py-20 px-8",children:[c.jsx(Ir,{course:t,onSubmit:x}),c.jsx(Wt,{children:c.jsx("section",{className:"my-8 grid gap-4 max-w-7xl mx-auto grid-cols-1 lg:grid-cols-3",children:_.map((F,E)=>c.jsx(Xt,{onModuleOrderUpdate:S,index:E,onModuleTitleUpdate:A,onVideoSelect:V,onAddVideo:()=>F&&g(F),title:F||"",videos:s.filter(b=>b.moduleName===F)},F))})})]})]})}const Ir=({course:e,onSubmit:t})=>c.jsxs(c.Fragment,{children:[c.jsx("h1",{className:"text-gray-50 text-2xl mb-6",children:e.title}),c.jsxs("form",{onSubmit:t,className:"flex items-center justify-end gap-4",children:[c.jsx("input",{name:"name",type:"text",placeholder:"Nombre del nuevo módulo",className:"py-3 px-6 text-lg rounded-full"}),c.jsx(we,{type:"submit",className:"bg-green-500",children:"Añadir módulo"})]})]});export{Yr as default};
